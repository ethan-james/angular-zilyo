"use strict";angular.module("angularZilyoApp",["ngCookies","ngResource","ngSanitize","ui.router","ui.bootstrap","ngMap","ngMaterial"]).config(["$stateProvider","$urlRouterProvider","$locationProvider",function(a,b,c){b.otherwise("/"),c.html5Mode(!0)}]),angular.module("angularZilyoApp").filter("capitalize",function(){return function(a){return a[0].toLocaleUpperCase()+a.substr(1)}}),angular.module("angularZilyoApp").directive("listingInfoWindow",function(){return{templateUrl:"app/listing-info-window/listing-info-window.html",restrict:"E",scope:{listing:"="},link:function(a,b,c){a.amenities=_.map(a.listing.amenities,function(a){return a.text}).join(", ")}}}),angular.module("angularZilyoApp").controller("MainCtrl",["$http","$scope","NgMap","$compile",function(a,b,c,d){b.map=null,b.zoom=15,b.markers=[],b.params={guests:1,numofbedrooms:0,provider:[],pricemin:0,pricemax:1e3,stimestamp:new Date,etimestamp:new Date((new Date).getTime()+864e5)},b.$watch("params",_.debounce(function(a){b.markerClusterer&&b.updateMarkers(b.delta())},500),!0),b.providers=["airbnb","alwaysonvacation","apartmentsapart","bedycasa","bookingpal","citiesreference","edomizil","geronimo","gloveler","holidayvelvet","homeaway","homestay","hostelworld","housetrip","interhome","nflats","roomorama","stopsleepgo","theotherhome","travelmob","vacationrentalpeople","vaycayhero","waytostay","webchalet","zaranga"],b.parameterize=function(a){return _.reduce(a,function(a,b,c){return b?a.concat(c+"="+b):a},[]).join("&")},b.filters=Object.create({guests:function(a,b){return a.guests>=b},numofbedrooms:function(a,b){return a.numofbedrooms>=b},pricemin:function(a,b){return a.nightly>=b},pricemax:function(a,b){return a.nightly<=b},provider:function(a,b){return b&&b.length?-1!==b.indexOf(a.provider):!0},availability:function(a,b){return _.some(a.availability,function(a){return a.start<=b.stimestamp.getTime()/1e3&&a.end>=b.etimestamp.getTime()/1e3})}},{}),b.filterMarkers=function(a){return _.filter(b.markers,function(a){return _.reduce(b.params,function(c,d,e){return b.filters[e]?c&&b.filters[e](a,b.params[e]):"stimestamp"==e||"etimestamp"==e?c&&b.filters.availability(a,b.params):c},!0)})},b.difference=function(a,b){return _.filter(a,function(a){return _.every(b,function(b){return b.id!==a.id})})},b.addMarkers=function(a){b.markers=b.markers.concat(b.difference(a,b.markers))},b.updateMarkers=function(a){b.markerClusterer.addMarkers(a.add),b.markerClusterer.removeMarkers(a.remove),b.showing=b.markerClusterer.getTotalMarkers()},b.delta=function(a){var c=b.markerClusterer.getMarkers(),d=b.filterMarkers();return{add:b.difference(d,c),remove:a===!1?[]:b.difference(c,d)}},b.refresh=function(c){var d="/api/v1/listings/count",e=c.getBounds(),f={nelatitude:e.O.j,nelongitude:e.j.O,swlatitude:e.O.O,swlongitude:e.j.j};a.get(d+"?"+b.parameterize(f)).then(function(a){var c=JSON.parse(a.data);b.loading=c.result.totalResults,_.times(c.result.totalPages,function(a){return b.fetch(angular.extend(f,{resultsperpage:20,page:a+1}))})},function(a){console.log(a)})},b.fetch=function(c){var e="/api/v1/listings";a.get(e+"?"+b.parameterize(c)).then(function(a){var c=JSON.parse(a.data);b.addMarkers(_.map(c.result,function(a,c){var e,f=angular.extend(b.$new(),{listing:a}),g=d('<listing-info-window listing="listing"></listing-info-window>')(f),h=new google.maps.Marker({id:a.id,title:a.attr.heading,position:new google.maps.LatLng(a.latLng[0],a.latLng[1]),guests:a.attr.occupancy,numofbedrooms:a.attr.bedrooms,nightly:a.price.nightly,provider:a.provider.cid,availability:a.availability});return h.addListener("click",function(){e&&e.getMap()?e.close():(e||(e=new google.maps.InfoWindow({content:g[0]})),e.open(b.map,h))}),h})),b.markerClusterer||(b.markerClusterer=new MarkerClusterer(b.map,[],{})),b.updateMarkers(b.delta(!1)),b.loading=b.loading-c.result.length},function(a){console.log(a)})},b.loadMap=function(a,d){b.center={latitude:a,longitude:d},c.getMap().then(function(a){b.preloaded=!0;var c=document.getElementById("pac-input"),d=new google.maps.places.SearchBox(c);a.controls[google.maps.ControlPosition.TOP_LEFT].push(c),a.addListener("bounds_changed",_.debounce(b.refresh.bind(this,a),1e3)),a.addListener("bounds_changed",function(){d.setBounds(a.getBounds())}),d.addListener("places_changed",function(){var b=d.getPlaces(),c=new google.maps.LatLngBounds;0!=b.length&&(b.forEach(function(a){c.extend(a.geometry.location)}),a.fitBounds(c),a.setZoom(17))}),b.refresh(a)})},navigator.geolocation.getCurrentPosition(function(a){b.loadMap(a.coords.latitude,a.coords.longitude)},function(){b.loadMap(37.3175,-122.0419)})}]),angular.module("angularZilyoApp").config(["$stateProvider",function(a){a.state("main",{url:"/",templateUrl:"app/main/main.html",controller:"MainCtrl"})}]),angular.module("angularZilyoApp").directive("multipleSelect",function(){return{templateUrl:"app/multiple-select/multiple-select.html",restrict:"E",require:"ngModel",scope:{options:"="},link:function(a,b,c,d){a.$watch(function(){return d.$modelValue},function(b){a.select=a.options.reduce(function(a,c){return a[c]=-1!==b.indexOf(c),a},{})}),a.$watch("select",function(b){a.value=_.reduce(b,function(a,b,c){return b?a.concat(c):a},[]),d.$setViewValue(a.value)},!0),a.toggle=function(b,c){b.stopPropagation(),a.select[c]=!a.select[c]}}}}),angular.module("angularZilyoApp").factory("Modal",["$rootScope","$modal",function(a,b){function c(c,d){var e=a.$new();return c=c||{},d=d||"modal-default",angular.extend(e,c),b.open({templateUrl:"components/modal/modal.html",windowClass:d,scope:e})}return{confirm:{"delete":function(a){return a=a||angular.noop,function(){var b,d=Array.prototype.slice.call(arguments),e=d.shift();b=c({modal:{dismissable:!0,title:"Confirm Delete",html:"<p>Are you sure you want to delete <strong>"+e+"</strong> ?</p>",buttons:[{classes:"btn-danger",text:"Delete",click:function(a){b.close(a)}},{classes:"btn-default",text:"Cancel",click:function(a){b.dismiss(a)}}]}},"modal-danger"),b.result.then(function(b){a.apply(b,d)})}}}}}]),angular.module("angularZilyoApp").controller("NavbarCtrl",["$scope","$location",function(a,b){a.menu=[{title:"Home",link:"/"}],a.isCollapsed=!0,a.isActive=function(a){return a===b.path()}}]),angular.module("angularZilyoApp").run(["$templateCache",function(a){a.put("app/listing-info-window/listing-info-window.html","<div class=listing-info-window><div>{{listing.attr.heading}} <b>${{listing.price.nightly}}</b> / night</div><div><img src={{listing.photos[0].small}} alt={{listing.photos[0].caption}}></div><div><b>Occupancy</b> {{listing.attr.occupancy}} guests, <b>Bedrooms</b> {{listing.attr.bedrooms}}, <b>Bathrooms</b> {{listing.attr.bathrooms}}</div><div><b>Amenities</b> {{amenities}}</div><div><a href={{listing.provider.url}} target=_blank>View Listing</a></div></div>"),a.put("app/main/main.html",'<div class=col-md-12><input id=pac-input class=form-control><ng-map zoom=17 center="[{{center.latitude}}, {{center.longitude}}]" id=map><custom-control id=filters position=TOP_RIGHT index=1><div id=handle class=clearfix><i class="fa fa-circle-o-notch pull-left spinner" id=spinner ng-show=loading></i> <span id=status><span id=showing ng-show="showing != markers.length">Showing <b>{{showing}}</b> of</span> <b>{{markers.length}}</b> listings <span id=queue ng-show=loading>(loading <b>{{loading}}</b>)</span></span> <button aria-expanded=false class="btn btn-primary pull-right" ng-show=!expanded ng-click="expanded = true"><i class="fa fa-caret-left"></i></button> <button aria-expanded=false class="btn btn-primary pull-right" ng-show=expanded ng-click="expanded = false"><i class="fa fa-caret-down"></i></button></div><div ng-show=expanded id=panel><div class="input-group col-md-12"><label for=guests class="col-md-9 control-label">Minimum guests allowed</label><span class=col-md-3><input type=number id=bedrooms ng-model=params.guests class=form-control></span></div><div class="input-group col-md-12"><label for=bedrooms class="col-md-9 control-label">Minimum number of bedrooms</label><span class=col-md-3><input type=number id=bedrooms ng-model=params.numofbedrooms class=form-control></span></div><div class="input-group col-md-12"><label for=pricemax class="col-md-6 control-label">Provider</label><span class=col-md-6><multiple-select ng-model=params.provider options=providers></multiple-select></span></div><div class="input-group col-md-12"><label for=pricemax class="col-md-6 control-label">Maximum price per night: <b>${{params.pricemax}}</b></label><span class=col-md-6><input type=range id=pricemax ng-model=params.pricemax min=0 max=1000 step=5></span></div><div class="input-group col-md-12"><label for=pricemin class="col-md-6 control-label">Minimum price per night: <b>${{params.pricemin}}</b></label><span class=col-md-6><input type=range id=pricemin ng-model=params.pricemin min=0 max=1000 step=5></span></div><div class="input-group col-md-12"><div class=col-md-6><md-datepicker ng-model=params.stimestamp md-placeholder="Check in date"></md-datepicker></div><div class=col-md-6><md-datepicker ng-model=params.etimestamp md-placeholder="Check out date"></md-datepicker></div></div></div></custom-control><custom-control position=TOP_LEFT index=2><a class="btn btn-success" href=//github.com/ethan-james/angular-zilyo id=github target=_blank><i class="fa fa-github"></i></a></custom-control></ng-map></div><div id=overlay ng-show=!preloaded><div class=spinner><i class="fa fa-circle-o-notch"></i></div></div>'),a.put("app/multiple-select/multiple-select.html",'<div class="form-inline multiple-select"><div class="form-group dropdown"><div class=input-group><input ng-model=value class=form-control> <span class=input-group-addon><button data-toggle=dropdown aria-haspopup=true aria-expanded=false class=dropdown-toggle><i class="fa fa-caret-down"></i></button></span></div><ul class=dropdown-menu><li ng-repeat="option in options" class=col-md-12 ng-click="toggle($event, option)"><i class="fa fa-square-o" ng-show=!select[option]></i> <i class="fa fa-check-square-o" ng-show=select[option]></i> {{option | capitalize}}</li></ul></div></div><!-- funsportsgear.com -->'),a.put("components/modal/modal.html",'<div class=modal-header><button ng-if=modal.dismissable type=button ng-click=$dismiss() class=close>&times;</button><h4 ng-if=modal.title ng-bind=modal.title class=modal-title></h4></div><div class=modal-body><p ng-if=modal.text ng-bind=modal.text></p><div ng-if=modal.html ng-bind-html=modal.html></div></div><div class=modal-footer><button ng-repeat="button in modal.buttons" ng-class=button.classes ng-click=button.click($event) ng-bind=button.text class=btn></button></div>'),a.put("components/navbar/navbar.html",'<div class="navbar navbar-default navbar-static-top" ng-controller=NavbarCtrl><div class=container><div class=navbar-header><button class=navbar-toggle type=button ng-click="isCollapsed = !isCollapsed"><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a href="/" class=navbar-brand>angular-zilyo</a></div><div collapse=isCollapsed class="navbar-collapse collapse" id=navbar-main><ul class="nav navbar-nav"><li ng-repeat="item in menu" ng-class="{active: isActive(item.link)}"><a ng-href={{item.link}}>{{item.title}}</a></li></ul></div></div></div>')}]);